<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dual Video Player</title>
    <style>
        /* CSS siêu nhỏ gọn */
        :root {
            --bg-color: #121212;
            --panel-bg: rgba(30, 30, 30, 0.85);
            --border-color: #333;
            --text-color: #e0e0e0;
            --text-color-light: #999;
            --highlight-color: #00aaff;
        }

        body, html {
            margin: 0; padding: 0; font-family: Arial, sans-serif;
            background: var(--bg-color); color: var(--text-color);
            overflow: hidden; height: 100vh; width: 100vw;
        }

        #app-container { display: flex; height: 100%; width: 100%; }

        .video-slot {
            width: 50%; height: 100%; position: relative;
            display: flex; justify-content: center; align-items: center;
            border: 2px dashed var(--border-color); box-sizing: border-box;
            transition: border-color 0.3s;
        }

        .video-slot:first-child { border-right: 1px solid var(--border-color); }
        .video-slot:last-child { border-left: 1px solid var(--border-color); }
        .video-slot.dragging-over {
            border-color: var(--highlight-color);
            background-color: rgba(0, 170, 255, 0.1);
        }
        .video-slot.has-video { border-color: transparent; }
        .video-slot video { max-width: 100%; max-height: 100%; display: block; }
        .drop-text { position: absolute; font-size: 1.5em; color: #555; pointer-events: none; }
        .hidden { display: none !important; }

        #controls {
            position: absolute; bottom: 20px; left: 50%;
            transform: translateX(-50%); z-index: 100;
            display: flex; align-items: center; gap: 15px;
            padding: 10px 20px;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .icon-btn { background: none; border: none; color: var(--text-color); cursor: pointer; padding: 5px; }
        .icon-btn svg { width: 22px; height: 22px; fill: currentColor; display: block; }
        #timeline-slider { width: 450px; cursor: pointer; }

        #speed-controls { display: flex; background: rgba(0,0,0,0.2); border-radius: 8px; }
        .speed-btn {
            background: none; border: none; color: var(--text-color-light);
            padding: 6px 12px; cursor: pointer; font-size: 14px;
        }
        .speed-btn.active { color: #fff; background: var(--highlight-color); border-radius: 8px; }
    </style>
</head>
<body>
    <input type="file" id="file-input" accept="video/*" multiple style="display: none;">

    <div id="app-container">
        <div class="video-slot" id="slot-left">
            <video id="video-left" playsinline></video>
            <p class="drop-text" id="drop-text-left">Kéo & Thả Video Trái (hoặc Ctrl+D)</p>
        </div>
        <div class="video-slot" id="slot-right">
            <video id="video-right" playsinline></video>
            <p class="drop-text" id="drop-text-right">Kéo & Thả Video Phải (hoặc Ctrl+D)</p>
        </div>
    </div>

    <div id="controls">
        <button id="play-pause-btn" class="icon-btn" title="Play/Pause (Spacebar)">
            <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg id="pause-icon" class="hidden" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        </button>
        <button id="mute-btn" class="icon-btn" title="Mute/Unmute">
            <svg id="unmute-icon" class="hidden" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
            <svg id="mute-icon" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L7 9H3v6h4l5 5v-8.27l-5.73-5.73z"/></svg>
        </button>
        <input type="range" id="timeline-slider" value="0" step="0.01" max="100">
        <div id="speed-controls">
            <button class="speed-btn active" data-speed="1">1x</button>
            <button class="speed-btn" data-speed="2">2x</button>
            <button class="speed-btn" data-speed="3">3x</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Lấy các element cần thiết
            const fileInput = document.getElementById('file-input');
            const videoLeft = document.getElementById('video-left');
            const videoRight = document.getElementById('video-right');
            const slotLeft = document.getElementById('slot-left');
            const slotRight = document.getElementById('slot-right');
            const timeline = document.getElementById('timeline-slider');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            const muteBtn = document.getElementById('mute-btn');
            const muteIcon = document.getElementById('mute-icon');
            const unmuteIcon = document.getElementById('unmute-icon');
            const speedButtons = document.querySelectorAll('.speed-btn');

            const videos = [videoLeft, videoRight];
            const slots = [slotLeft, slotRight];
            let readyStates = [false, false];

            // --- Thiết lập ban đầu ---
            videoLeft.muted = false; // Video trái có thể phát âm thanh
            videoRight.muted = true; // Video phải luôn tắt tiếng để tránh xung đột
            updateMuteButton();

            // --- Chức năng Tải Video ---
            function setupDragDrop(slot, index) {
                slot.addEventListener('dragover', e => { e.preventDefault(); slot.classList.add('dragging-over'); });
                slot.addEventListener('dragleave', e => { e.preventDefault(); slot.classList.remove('dragging-over'); });
                slot.addEventListener('drop', e => {
                    e.preventDefault(); slot.classList.remove('dragging-over');
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('video/')) loadVideo(index, file);
                });
            }
            slots.forEach(setupDragDrop);

            function handleFileSelect(e) {
                const files = e.target.files;
                if (!files.length) return;
                if (files.length >= 1 && files[0].type.startsWith('video/')) loadVideo(0, files[0]);
                if (files.length >= 2 && files[1].type.startsWith('video/')) loadVideo(1, files[1]);
                fileInput.value = ''; // Reset để có thể chọn lại cùng file
            }
            fileInput.addEventListener('change', handleFileSelect);

            function loadVideo(index, file) {
                const video = videos[index];
                video.src = URL.createObjectURL(file);
                document.getElementById(`drop-text-${index === 0 ? 'left' : 'right'}`).classList.add('hidden');
                slots[index].classList.add('has-video');
                video.addEventListener('loadedmetadata', () => {
                    readyStates[index] = true;
                    if (readyStates[0] && readyStates[1]) syncTimelineDuration();
                    else if (readyStates[0] || readyStates[1]) syncTimelineDuration();
                }, { once: true });
            }

            // --- Chức năng Điều khiển Video ---
            function syncTimelineDuration() {
                const duration1 = videoLeft.duration || 0;
                const duration2 = videoRight.duration || 0;
                const maxDuration = Math.max(duration1, duration2);
                if (isFinite(maxDuration)) timeline.max = maxDuration;
            }

            function togglePlayPause() {
                if (!videoLeft.src && !videoRight.src) return;
                const isPaused = videoLeft.paused || videoRight.paused;
                const action = isPaused ? 'play' : 'pause';
                videos.forEach(v => v.src && v[action]());
            }

            function updatePlayButton(isPlaying) {
                 playIcon.classList.toggle('hidden', isPlaying);
                 pauseIcon.classList.toggle('hidden', !isPlaying);
            }
            
            function toggleMute() {
                videoLeft.muted = !videoLeft.muted;
                updateMuteButton();
            }

            function updateMuteButton() {
                muteIcon.classList.toggle('hidden', !videoLeft.muted);
                unmuteIcon.classList.toggle('hidden', videoLeft.muted);
            }
            
            function setPlaybackSpeed(speed) {
                videos.forEach(v => v.playbackRate = speed);
                speedButtons.forEach(btn => {
                    btn.classList.toggle('active', parseFloat(btn.dataset.speed) === speed);
                });
            }

            // --- Gán sự kiện cho các nút điều khiển ---
            playPauseBtn.addEventListener('click', togglePlayPause);
            muteBtn.addEventListener('click', toggleMute);

            timeline.addEventListener('input', () => {
                const time = timeline.value;
                videos.forEach(v => v.currentTime = time);
            });
            
            videoLeft.addEventListener('timeupdate', () => {
                if (!timeline.matches(':active')) timeline.value = videoLeft.currentTime;
            });

            videoLeft.addEventListener('play', () => updatePlayButton(true));
            videoLeft.addEventListener('pause', () => updatePlayButton(false));

            speedButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const speed = parseFloat(button.dataset.speed);
                    setPlaybackSpeed(speed);
                });
            });

            // --- Phím tắt ---
            window.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return;
                if (e.ctrlKey && e.key.toLowerCase() === 'd') {
                    e.preventDefault();
                    fileInput.click();
                }
                if (e.code === 'Space') {
                    e.preventDefault();
                    togglePlayPause();
                }
            });
        });
    </script>
</body>
</html>
